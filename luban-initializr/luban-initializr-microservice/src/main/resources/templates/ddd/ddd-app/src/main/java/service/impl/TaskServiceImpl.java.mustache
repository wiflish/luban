package {{packageName}}.service.impl;

import cn.hutool.core.bean.BeanUtil;
import com.wiflish.luban.core.dto.OneResponse;
import com.wiflish.luban.core.dto.PageResponse;
import com.wiflish.luban.core.dto.Response;
import com.wiflish.luban.core.dto.exception.Assert;
import {{packageName}}.domain.entity.Task;
import {{packageName}}.domain.repository.TaskRepository;
import {{packageName}}.domain.service.TaskSyncDomainService;
import {{packageName}}.dto.TaskDTO;
import {{packageName}}.dto.cmd.AddTaskCmd;
import {{packageName}}.dto.query.TaskQuery;
import {{packageName}}.infra.converter.TaskConverter;
import {{packageName}}.service.TaskService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 任务服务
 *
 * @author wiflish
 * @since {{currentDate}}
 */
@Slf4j
@Service
public class TaskServiceImpl implements TaskService {
    @Autowired
    private TaskSyncDomainService taskSyncDomainService;

    @Autowired
    private TaskRepository taskRepository;

    @Override
    public OneResponse<Long> addTask(AddTaskCmd addTaskCmd) {
        Assert.notNull(addTaskCmd.getName(), "task.name不能为null");

        Task task = BeanUtil.copyProperties(addTaskCmd, Task.class);

        task.todo();

        return OneResponse.of(task.getId());
    }

    @Override
    public Response todo(Long taskId) {
        Task task = taskRepository.selectById(taskId);
        task.todo();
        return Response.of();
    }

    @Override
    public Response doing(Long taskId) {
        Task task = taskRepository.selectById(taskId);
        task.doing();
        return Response.of();
    }

    @Override
    public Response done(Long taskId) {
        Task task = taskRepository.selectById(taskId);
        task.done();
        return Response.of();
    }

    @Override
    public PageResponse<TaskDTO> pagedTasks(TaskQuery query) {
         return taskRepository.selectByCriteria(query);
    }

    @Override
    public OneResponse<TaskDTO> getTaskById(Long taskId) {
        Task task = taskRepository.selectById(taskId);
        TaskDTO taskDTO = TaskConverter.toTaskDTO(task);

        return OneResponse.of(taskDTO);
    }
}
